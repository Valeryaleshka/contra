<div class="container">
  <div class="test" style="width: 160px; height: 145px"></div>
  <div class="control">
    <button id="animateButton">
      Animate
    </button>
    <button id="stopButton">
      Stop
    </button>
    <select id="selectFrame">

    </select>

  </div>
</div>

<script>
  const jump = {
    slides: [
      { x: 0, y: 0, w: 240, h: 240, duration: 70 },
      { x: -240, y: 0, w: 240, h: 240, duration: 70 },
      { x: -480, y: 0, w: 240, h: 240, duration: 70 },
      { x: -720, y: 0, w: 240, h: 240, duration: 70 },
      { x: -960, y: 0, w: 240, h: 240, duration: 70 },
      { x: -1200, y: 0, w: 240, h: 240, duration: 70 },
      { x: -1440, y: 0, w: 240, h: 240, duration: 70 },
      { x: -1680, y: 0, w: 240, h: 240, duration: 70 },
      { x: 0, y: -240, w: 240, h: 240, duration: 70 },
      { x: -240, y: -240, w: 240, h: 240, duration: 70 },
      { x: -480, y: -240, w: 240, h: 240, duration: 70 },
      { x: -720, y: -240, w: 240, h: 240, duration: 70 },
      { x: -960, y: -240, w: 240, h: 240, duration: 70 },
      { x: -1200, y: -240, w: 240, h: 240, duration: 70 },
      { x: -1440, y: -240, w: 240, h: 240, duration: 70 },
      { x: -1680, y: -240, w: 240, h: 240, duration: 70 },
      { x: 0, y: -480, w: 240, h: 240, duration: 70 },
      { x: -240, y: -480, w: 240, h: 240, duration: 70 },
      { x: -480, y: -480, w: 240, h: 240, duration: 70 },
      { x: -720, y: -480, w: 240, h: 240, duration: 70 },
      { x: -960, y: -480, w: 240, h: 240, duration: 70 },
      { x: -1200, y: -480, w: 240, h: 240, duration: 70 },
      { x: -1440, y: -480, w: 240, h: 240, duration: 70 },
      { x: -1680, y: -480, w: 240, h: 240, duration: 70 },
      { x: 0, y: -720, w: 240, h: 240, duration: 70 },
      { x: -240, y: -720, w: 240, h: 240, duration: 70 },
      { x: -480, y: -720, w: 240, h: 240, duration: 70 },
      { x: -720, y: -720, w: 240, h: 240, duration: 70 },
      { x: -960, y: -720, w: 240, h: 240, duration: 70 },
      { x: -1200, y: -720, w: 240, h: 240, duration: 70 },
      { x: -1440, y: -720, w: 240, h: 240, duration: 70 },
      { x: -1680, y: -720, w: 240, h: 240, duration: 70 },
      { x: 0, y: -960, w: 240, h: 240, duration: 70 },
      { x: -240, y: -960, w: 240, h: 240, duration: 70 },
      { x: -480, y: -960, w: 240, h: 240, duration: 70 },
      { x: -720, y: -960, w: 240, h: 240, duration: 70 },
      { x: -960, y: -960, w: 240, h: 240, duration: 70 },
      { x: -1200, y: -960, w: 240, h: 240, duration: 70 },
      { x: -1440, y: -960, w: 240, h: 240, duration: 70 },
      { x: -1680, y: -960, w: 240, h: 240, duration: 70 },
      { x: 0, y: -1200, w: 240, h: 240, duration: 70 },
      { x: -240, y: -1200, w: 240, h: 240, duration: 70 },
      { x: -480, y: -1200, w: 240, h: 240, duration: 70 },
      { x: -720, y: -1200, w: 240, h: 240, duration: 70 },
      { x: -960, y: -1200, w: 240, h: 240, duration: 70 },
      { x: -1200, y: -1200, w: 240, h: 240, duration: 70 },
      { x: -1440, y: -1200, w: 240, h: 240, duration: 70 },
      { x: -1680, y: -1200, w: 240, h: 240, duration: 70 },
      { x: 0, y: -1440, w: 240, h: 240, duration: 70 },
      { x: -240, y: -1440, w: 240, h: 240, duration: 70 },
      { x: -480, y: -1440, w: 240, h: 240, duration: 70 },
      { x: -720, y: -1440, w: 240, h: 240, duration: 70 },
      { x: -960, y: -1440, w: 240, h: 240, duration: 70 },
      { x: -1200, y: -1440, w: 240, h: 240, duration: 70 },
      { x: -1440, y: -1440, w: 240, h: 240, duration: 70 },
      { x: -1680, y: -1440, w: 240, h: 240, duration: 70 },
      { x: 0, y: -1680, w: 240, h: 240, duration: 70 },
      { x: -240, y: -1680, w: 240, h: 240, duration: 70 },
      { x: -480, y: -1680, w: 240, h: 240, duration: 70 },
      { x: -720, y: -1680, w: 240, h: 240, duration: 70 },
      { x: -960, y: -1680, w: 240, h: 240, duration: 70 },
      { x: -1200, y: -1680, w: 240, h: 240, duration: 70 },
      { x: -1440, y: -1680, w: 240, h: 240, duration: 70 },
      { x: -1680, y: -1680, w: 240, h: 240, duration: 70 },


    ],
    isCycle: true
  };

  const fall = {
    slides: [
      //{ x: -264, y: -100, w: 41, h: 78, duration: 120 },
      // { x: -303, y: -100, w: 41, h: 78, duration: 120 },
    ],
    isCycle: true
  };

  const jumpAndFire = {
    slides: [
      // { x: 0, y: -236, w: 160, h: 142, duration: 70 },
      // { x: -150, y: -236, w: 150, h: 142, duration: 70 },
      // { x: -300, y: -236, w: 150, h: 142, duration: 70 },
      // { x: -450, y: -236, w: 150, h: 142, duration: 70 },
      // { x: -600, y: -236, w: 150, h: 142, duration: 70 },
      // { x: -750, y: -236, w: 150, h: 142, duration: 70 },
      // { x: -900, y: -236, w: 150, h: 142, duration: 70 },
      // { x: -1050, y: -236, w: 150, h: 142, duration: 70 },
      // { x: -1200, y: -236, w: 150, h: 142, duration: 70 },
    ],
    isCycle: true
  };

  let frameId = 0;
  let timeOut;

  const element = document.querySelector('.test');

  const drawFrame = frame => {
    const { x, y, w, h, duration } = frame;
    element.style.backgroundPositionX = `${x}px`;
    element.style.backgroundPositionY = `${y}px`;
    element.style.width = `${w}px`;
    element.style.height = `${h}px`;
    return duration;
  }

  const animate = (..._animations) => {
    const animations = [..._animations];
    let idx;
    clearTimeout(timeOut);

    const nextSlide = (slides, isCycle) => {

      const duration = drawFrame(slides[frameId]);

      if (isCycle) {
        frameId = (frameId + 1) % slides.length;
        timeOut = setTimeout(() => nextSlide(slides, isCycle), duration)
      } else {
        if (slides[frameId + 1]) {
          frameId += 1;
          console.log(frameId)
          timeOut = setTimeout(() => nextSlide(slides, isCycle), duration);
        } else {
          frameId = 0;
          nextAnimation()
        };
      }
    };

    const nextAnimation = () => {
      console.log(idx)
      if (idx === undefined) {
        idx = 0;
      } else if (animations[idx + 1]) {
        idx += 1;
      } else {
        clearTimeout(timeOut);
        return;
      };
      animation = animations[idx];
      const slides = animation.slides;
      const isCycle = animation.isCycle;
      console.log(slides, isCycle)
      nextSlide(slides, isCycle)
    };

    nextAnimation()

  };

  const chooseSlide = (animation) => {
    clearTimeout(timeOut);
    drawFrame(animation[0])
  };

  drawFrame(jump.slides[0]);


  animateButton.onclick = () => {

    //frameId = 0; animate(jumpAndFire);
    frameId = 0; animate(jump, jumpAndFire);
  };

  stopButton.onclick = () => {
    clearTimeout(timeOut);
    frameId = 0;
  }

</script>


<style>
  .container {
    width: 100vw;
    height: 100vh;
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
  }

  .control {
    position: fixed;
    top: 0;
    left: 0;
    height: 50px;
  }

  .control>button {
    height: 100%;
  }

  .test {
    width: 160px;
    height: 145px;
    background-image: url(./sprite-sheets/enemy/fire.png);
    background-position: 0px 0px;
    background-repeat: no-repeat;
  }
</style>